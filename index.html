<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A drop-in replacement for dplyr, powered by DuckDB for performance. Also defines a set of generics that provide a low-level implementers interface for the high-level user interface of dplyr'.">
<title>A DuckDB-Backed Version of dplyr • duckplyr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A DuckDB-Backed Version of dplyr">
<meta property="og:description" content="A drop-in replacement for dplyr, powered by DuckDB for performance. Also defines a set of generics that provide a low-level implementers interface for the high-level user interface of dplyr'.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">duckplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/duckdblabs/duckplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="duckplyr">duckplyr<a class="anchor" aria-label="anchor" href="#duckplyr"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of duckplyr is to provide a drop-in replacement for dplyr that uses <a href="https://duckdb.org/" class="external-link">DuckDB</a> as a backend for fast operation. DuckDB is an in-process SQL OLAP database management system.</p>
<p>duckplyr also defines a set of generics that provide a low-level implementer’s interface for dplyr’s high-level user interface.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install duckplyr from CRAN with:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="o">(</span><span class="s">"duckplyr"</span><span class="o">)</span></span></pre>
<p>You can also install the development version of duckplyr from R-universe:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="o">(</span><span class="s">'duckplyr'</span>, repos <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="s">'https://duckdblabs.r-universe.dev'</span>, <span class="s">'https://cloud.r-project.org'</span><span class="o">)</span><span class="o">)</span></span></pre>
<p>Or from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<pre class="chroma">
<span><span class="c"># install.packages("pak", repos = sprintf("https://r-lib.github.io/p/pak/stable/%s/%s/%s", .Platform$pkgType, R.Version()$os, R.Version()$arch))</span></span>
<span><span class="nf">pak</span><span class="nf">::</span><span class="nf"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="o">(</span><span class="s">"duckdblabs/duckplyr"</span><span class="o">)</span></span></pre>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<pre class="chroma">
<span><span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://conflicted.r-lib.org/" class="external-link">conflicted</a></span><span class="o">)</span></span>
<span><span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://duckdblabs.github.io/duckplyr/">duckplyr</a></span><span class="o">)</span></span>
<span><span class="nf"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="o">(</span><span class="s">"filter"</span>, <span class="s">"duckplyr"</span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">[conflicted]</span> Will prefer <span style="color: #0000BB; font-weight: bold;">duckplyr</span>::filter over</span></span>
<span><span class="c">#&gt; any other package.</span></span></pre>
<p>There are two ways to use duckplyr.</p>
<ol style="list-style-type: decimal">
<li>To enable duckplyr for individual data frames, use <a href="https://duckdblabs.github.io/duckplyr/reference/as_duckplyr_df.html"><code>as_duckplyr_df()</code></a> as the first step in your pipe.</li>
<li>To enable duckplyr for the entire session, use <a href="https://duckdblabs.github.io/duckplyr/reference/methods_overwrite.html"><code>methods_overwrite()</code></a>.</li>
</ol>
<p>The examples below illustrate both methods. See also the companion <a href="https://github.com/Tmonster/duckplyr_demo" class="external-link">demo repository</a> for a use case with a large dataset.</p>
<div class="section level3">
<h3 id="usage-for-individual-data-frames">Usage for individual data frames<a class="anchor" aria-label="anchor" href="#usage-for-individual-data-frames"></a>
</h3>
<p>This example illustrates usage of duckplyr for individual data frames.</p>
<p>Use <a href="https://duckdblabs.github.io/duckplyr/reference/as_duckplyr_df.html"><code>as_duckplyr_df()</code></a> to enable processing with duckdb:</p>
<pre class="chroma">
<span><span class="nv">out</span> <span class="o">&lt;-</span></span>
<span>  <span class="nf">palmerpenguins</span><span class="nf">::</span><span class="nv"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="c"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span><span class="nf"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="o">(</span><span class="nf">where</span><span class="o">(</span><span class="nv">is.factor</span><span class="o">)</span>, <span class="nv">as.character</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/as_duckplyr_df.html">as_duckplyr_df</a></span><span class="o">(</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span>bill_area <span class="o">=</span> <span class="nv">bill_length_mm</span> <span class="o">*</span> <span class="nv">bill_depth_mm</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="o">(</span>.by <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="nv">species</span>, <span class="nv">sex</span><span class="o">)</span>, mean_bill_area <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="o">(</span><span class="nv">bill_area</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="o">(</span><span class="nv">species</span> <span class="o">!=</span> <span class="s">"Gentoo"</span><span class="o">)</span></span></pre>
<p>The result is a data frame or tibble, with its own class.</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="o">(</span><span class="nv">out</span><span class="o">)</span></span>
<span><span class="c">#&gt; [1] "duckplyr_df" "tbl_df"      "tbl"         "data.frame"</span></span>
<span><span class="nf"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="o">(</span><span class="nv">out</span><span class="o">)</span></span>
<span><span class="c">#&gt; [1] "species"        "sex"            "mean_bill_area"</span></span></pre>
<p>duckdb is responsible for eventually carrying out the operations. Despite the late filter, the summary is not computed for the Gentoo species.</p>
<pre class="chroma">
<span><span class="nv">out</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">explain</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="c">#&gt; ┌───────────────────────────┐</span></span>
<span><span class="c">#&gt; │          ORDER_BY         │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          ORDERS:          │</span></span>
<span><span class="c">#&gt; │      dataframe_42_42      │</span></span>
<span><span class="c">#&gt; │      42.___row_number ASC     │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │           FILTER          │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │   (species != 'Gentoo')   │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          EC: 344          │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │      STREAMING_WINDOW     │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │    ROW_NUMBER() OVER ()   │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │          ORDER_BY         │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          ORDERS:          │</span></span>
<span><span class="c">#&gt; │      dataframe_42_42      │</span></span>
<span><span class="c">#&gt; │      42.___row_number ASC     │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │       HASH_GROUP_BY       │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │             #0            │</span></span>
<span><span class="c">#&gt; │             #1            │</span></span>
<span><span class="c">#&gt; │          min(#2)          │</span></span>
<span><span class="c">#&gt; │          mean(#3)         │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │         PROJECTION        │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          species          │</span></span>
<span><span class="c">#&gt; │            sex            │</span></span>
<span><span class="c">#&gt; │       ___row_number       │</span></span>
<span><span class="c">#&gt; │         bill_area         │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │      STREAMING_WINDOW     │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │    ROW_NUMBER() OVER ()   │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │         PROJECTION        │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          species          │</span></span>
<span><span class="c">#&gt; │            sex            │</span></span>
<span><span class="c">#&gt; │         bill_area         │</span></span>
<span><span class="c">#&gt; └─────────────┬─────────────┘                             </span></span>
<span><span class="c">#&gt; ┌─────────────┴─────────────┐</span></span>
<span><span class="c">#&gt; │     R_DATAFRAME_SCAN      │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │         data.frame        │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          species          │</span></span>
<span><span class="c">#&gt; │       bill_length_mm      │</span></span>
<span><span class="c">#&gt; │       bill_depth_mm       │</span></span>
<span><span class="c">#&gt; │            sex            │</span></span>
<span><span class="c">#&gt; │   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │</span></span>
<span><span class="c">#&gt; │          EC: 344          │</span></span>
<span><span class="c">#&gt; └───────────────────────────┘</span></span></pre>
<p>All data frame operations are supported. Computation happens upon the first request.</p>
<pre class="chroma">
<span><span class="nv">out</span><span class="o">$</span><span class="nv">mean_bill_area</span></span>
<span><span class="c">#&gt; materializing:</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; --- Relation Tree ---</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="c">#&gt;   Order [___row_number ASC]</span></span>
<span><span class="c">#&gt;     Filter [!=(species, 'Gentoo')]</span></span>
<span><span class="c">#&gt;       Projection [species as species, sex as sex, mean_bill_area as mean_bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="c">#&gt;         Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="c">#&gt;           Order [___row_number ASC]</span></span>
<span><span class="c">#&gt;             Aggregate [species, sex, min(___row_number), mean(bill_area)]</span></span>
<span><span class="c">#&gt;               Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, bill_area as bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="c">#&gt;                 Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, *(bill_length_mm, bill_depth_mm) as bill_area]</span></span>
<span><span class="c">#&gt;                   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; -- Result Columns  --</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; - species (VARCHAR)</span></span>
<span><span class="c">#&gt; - sex (VARCHAR)</span></span>
<span><span class="c">#&gt; - mean_bill_area (DOUBLE)</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; [1] 770.2627 656.8523 694.9360 819.7503 984.2279</span></span></pre>
<p>After the computation has been carried out, the results are available immediately:</p>
<pre class="chroma">
<span><span class="nv">out</span></span>
<span><span class="c">#&gt; <span style="color: #555555;"># A tibble: 5 × 3</span></span></span>
<span><span class="c">#&gt;   <span style="font-weight: bold;">species</span>   <span style="font-weight: bold;">sex</span>    <span style="font-weight: bold;">mean_bill_area</span></span></span>
<span><span class="c">#&gt;   <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="c">#&gt; <span style="color: #555555;">1</span> Adelie    male             770.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">2</span> Adelie    female           657.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">3</span> Adelie    <span style="color: #BB0000;">NA</span>               695.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">4</span> Chinstrap female           820.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">5</span> Chinstrap male             984.</span></span></pre>
</div>
<div class="section level3">
<h3 id="session-wide-usage">Session-wide usage<a class="anchor" aria-label="anchor" href="#session-wide-usage"></a>
</h3>
<p>This example illustrates usage of duckplyr for all data frames in the R session.</p>
<p>Use <a href="https://duckdblabs.github.io/duckplyr/reference/methods_overwrite.html"><code>methods_overwrite()</code></a> to enable processing with duckdb for all data frames:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/methods_overwrite.html">methods_overwrite</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> Overwriting <span style="color: #0000BB;">dplyr</span> methods with <span style="color: #0000BB;">duckplyr</span></span></span>
<span><span class="c">#&gt; methods</span></span></pre>
<p>This is the same query as above, without <a href="https://duckdblabs.github.io/duckplyr/reference/as_duckplyr_df.html"><code>as_duckplyr_df()</code></a>:</p>
<pre class="chroma">
<span><span class="nv">out</span> <span class="o">&lt;-</span></span>
<span>  <span class="nf">palmerpenguins</span><span class="nf">::</span><span class="nv"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="c"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span><span class="nf"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="o">(</span><span class="nf">where</span><span class="o">(</span><span class="nv">is.factor</span><span class="o">)</span>, <span class="nv">as.character</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span>bill_area <span class="o">=</span> <span class="nv">bill_length_mm</span> <span class="o">*</span> <span class="nv">bill_depth_mm</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="o">(</span>.by <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="nv">species</span>, <span class="nv">sex</span><span class="o">)</span>, mean_bill_area <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="o">(</span><span class="nv">bill_area</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="o">(</span><span class="nv">species</span> <span class="o">!=</span> <span class="s">"Gentoo"</span><span class="o">)</span></span></pre>
<p>The result is a plain tibble now:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="o">(</span><span class="nv">out</span><span class="o">)</span></span>
<span><span class="c">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span></pre>
<p>Querying the number of rows also starts the computation:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="o">(</span><span class="nv">out</span><span class="o">)</span></span>
<span><span class="c">#&gt; materializing:</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; --- Relation Tree ---</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="c">#&gt;   Order [___row_number ASC]</span></span>
<span><span class="c">#&gt;     Filter [!=(species, 'Gentoo')]</span></span>
<span><span class="c">#&gt;       Projection [species as species, sex as sex, mean_bill_area as mean_bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="c">#&gt;         Projection [species as species, sex as sex, mean_bill_area as mean_bill_area]</span></span>
<span><span class="c">#&gt;           Order [___row_number ASC]</span></span>
<span><span class="c">#&gt;             Aggregate [species, sex, min(___row_number), mean(bill_area)]</span></span>
<span><span class="c">#&gt;               Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, bill_area as bill_area, row_number() OVER () as ___row_number]</span></span>
<span><span class="c">#&gt;                 Projection [species as species, island as island, bill_length_mm as bill_length_mm, bill_depth_mm as bill_depth_mm, flipper_length_mm as flipper_length_mm, body_mass_g as body_mass_g, sex as sex, "year" as year, *(bill_length_mm, bill_depth_mm) as bill_area]</span></span>
<span><span class="c">#&gt;                   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; -- Result Columns  --</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; - species (VARCHAR)</span></span>
<span><span class="c">#&gt; - sex (VARCHAR)</span></span>
<span><span class="c">#&gt; - mean_bill_area (DOUBLE)</span></span>
<span><span class="c">#&gt; [1] 5</span></span></pre>
<p>Restart R, or call <a href="https://duckdblabs.github.io/duckplyr/reference/methods_overwrite.html"><code>methods_restore()</code></a> to revert to the default dplyr implementation.</p>
<pre class="chroma">
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/methods_overwrite.html">methods_restore</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> Restoring <span style="color: #0000BB;">dplyr</span> methods</span></span></pre>
<p>dplyr is active again:</p>
<pre class="chroma">
<span><span class="nf">palmerpenguins</span><span class="nf">::</span><span class="nv"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="c"># CAVEAT: factor columns are not supported yet</span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span><span class="nf"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="o">(</span><span class="nf">where</span><span class="o">(</span><span class="nv">is.factor</span><span class="o">)</span>, <span class="nv">as.character</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="o">(</span>bill_area <span class="o">=</span> <span class="nv">bill_length_mm</span> <span class="o">*</span> <span class="nv">bill_depth_mm</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="o">(</span>.by <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="nv">species</span>, <span class="nv">sex</span><span class="o">)</span>, mean_bill_area <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="o">(</span><span class="nv">bill_area</span><span class="o">)</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="o">(</span><span class="nv">species</span> <span class="o">!=</span> <span class="s">"Gentoo"</span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #555555;"># A tibble: 5 × 3</span></span></span>
<span><span class="c">#&gt;   <span style="font-weight: bold;">species</span>   <span style="font-weight: bold;">sex</span>    <span style="font-weight: bold;">mean_bill_area</span></span></span>
<span><span class="c">#&gt;   <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #555555; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="c">#&gt; <span style="color: #555555;">1</span> Adelie    male             770.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">2</span> Adelie    female           657.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">3</span> Adelie    <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="c">#&gt; <span style="color: #555555;">4</span> Chinstrap female           820.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">5</span> Chinstrap male             984.</span></span></pre>
</div>
</div>
<div class="section level2">
<h2 id="telemetry">Telemetry<a class="anchor" aria-label="anchor" href="#telemetry"></a>
</h2>
<p>We would like to guide our efforts towards improving duckplyr, focusing on the features with the most impact. To this end, duckplyr collects and uploads telemetry data, but only if permitted by the user. The data collected contains:</p>
<ul>
<li>The package version</li>
<li>The error message</li>
<li>The operation being performed, and the arguments
<ul>
<li>For the input data frames, only the structure is included (column types only), no column names or data</li>
</ul>
</li>
</ul>
<p>The first time the package encounters an unsupported function, data type, or operation, instructions are printed to the console.</p>
<pre class="chroma">
<span><span class="nf">palmerpenguins</span><span class="nf">::</span><span class="nv"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/as_duckplyr_df.html">as_duckplyr_df</a></span><span class="o">(</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="o">(</span>bill_area <span class="o">=</span> <span class="nv">bill_length_mm</span> <span class="o">*</span> <span class="nv">bill_depth_mm</span><span class="o">)</span> <span class="o"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="nf"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="o">(</span><span class="m">3</span><span class="o">)</span></span>
<span><span class="c">#&gt; The <span style="color: #0000BB;">duckplyr</span> package is configured to fall back to <span style="color: #0000BB;">dplyr</span> when it encounters an</span></span>
<span><span class="c">#&gt; incompatibility. Fallback events can be collected and uploaded for analysis to</span></span>
<span><span class="c">#&gt; guide future development. By default, no data will be collected or uploaded.</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> A fallback situation just occurred. The following information would have been</span></span>
<span><span class="c">#&gt;   recorded:</span></span>
<span><span class="c">#&gt;   {"version":"0.3.1","message":"Can't convert columns of class &lt;factor&gt; to</span></span>
<span><span class="c">#&gt;   relational. Affected</span></span>
<span><span class="c">#&gt;   column:\n`...1`.","name":"transmute","x":{"...1":"factor","...2":"factor","...3":"numeric","...4":"numeric","...5":"integer","...6":"integer","...7":"factor","...8":"integer"},"args":{"dots":{"...9":"...3</span></span>
<span><span class="c">#&gt;   * ...4"}}}</span></span>
<span><span class="c">#&gt; → Run `duckplyr::fallback_sitrep()` to review the current settings.</span></span>
<span><span class="c">#&gt; → Run `Sys.setenv(DUCKPLYR_FALLBACK_COLLECT = 1)` to enable fallback logging,</span></span>
<span><span class="c">#&gt;   and `Sys.setenv(DUCKPLYR_FALLBACK_VERBOSE = 1)` in addition to enable</span></span>
<span><span class="c">#&gt;   printing of fallback situations to the console.</span></span>
<span><span class="c">#&gt; → Run `duckplyr::fallback_review()` to review the available reports, and</span></span>
<span><span class="c">#&gt;   `duckplyr::fallback_upload()` to upload them.</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> See `?duckplyr::fallback()` for details.</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #555555;">This message will be displayed once every eight hours.</span></span></span>
<span><span class="c">#&gt; materializing:</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; --- Relation Tree ---</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; Limit 3</span></span>
<span><span class="c">#&gt;   r_dataframe_scan(0xdeadbeef)</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; -- Result Columns  --</span></span>
<span><span class="c">#&gt; ---------------------</span></span>
<span><span class="c">#&gt; - bill_area (DOUBLE)</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; <span style="color: #555555;"># A tibble: 3 × 1</span></span></span>
<span><span class="c">#&gt;   <span style="font-weight: bold;">bill_area</span></span></span>
<span><span class="c">#&gt;       <span style="color: #555555; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="c">#&gt; <span style="color: #555555;">1</span>      731.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">2</span>      687.</span></span>
<span><span class="c">#&gt; <span style="color: #555555;">3</span>      725.</span></span></pre>
</div>
<div class="section level2">
<h2 id="extensibility">Extensibility<a class="anchor" aria-label="anchor" href="#extensibility"></a>
</h2>
<p>This package also provides generics, for which other packages may then implement methods.</p>
<pre class="chroma">
<span><span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://duckdblabs.github.io/duckplyr/">duckplyr</a></span><span class="o">)</span></span>
<span></span>
<span><span class="c"># Create a relational to be used by examples below</span></span>
<span><span class="nv">new_dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">x</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="o">(</span><span class="nv">x</span><span class="o">)</span><span class="o">)</span></span>
<span>  <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">new_relational</a></span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span><span class="nv">x</span><span class="o">)</span>, class <span class="o">=</span> <span class="s">"dfrel"</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span><span class="nv">mtcars_rel</span> <span class="o">&lt;-</span> <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">mtcars</span><span class="o">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span>, <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="o">]</span><span class="o">)</span></span>
<span></span>
<span><span class="c"># Example 1: return a data.frame</span></span>
<span><span class="nv">rel_to_df.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span><span class="o">}</span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_to_df</a></span><span class="o">(</span><span class="nv">mtcars_rel</span><span class="o">)</span></span>
<span><span class="c">#&gt;                    mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; Mazda RX4         21.0   6  160 110</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag     21.0   6  160 110</span></span>
<span><span class="c">#&gt; Datsun 710        22.8   4  108  93</span></span>
<span><span class="c">#&gt; Hornet 4 Drive    21.4   6  258 110</span></span>
<span><span class="c">#&gt; Hornet Sportabout 18.7   8  360 175</span></span>
<span></span>
<span><span class="c"># Example 2: A (random) filter</span></span>
<span><span class="nv">rel_filter.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">exprs</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="c"># A real implementation would evaluate the predicates defined</span></span>
<span>  <span class="c"># by the exprs argument</span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">df</span><span class="o">[</span><span class="nf"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="o">(</span><span class="nv">df</span><span class="o">)</span>, <span class="m">3</span>, replace <span class="o">=</span> <span class="kc">TRUE</span><span class="o">)</span>, <span class="o">]</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_filter</a></span><span class="o">(</span></span>
<span>  <span class="nv">mtcars_rel</span>,</span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span></span>
<span>    <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_function</a></span><span class="o">(</span></span>
<span>      <span class="s">"gt"</span>,</span>
<span>      <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_reference</a></span><span class="o">(</span><span class="s">"cyl"</span><span class="o">)</span>, <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_constant</a></span><span class="o">(</span><span class="s">"6"</span><span class="o">)</span><span class="o">)</span></span>
<span>    <span class="o">)</span></span>
<span>  <span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;                  mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag   21.0   6  160 110</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag.1 21.0   6  160 110</span></span>
<span><span class="c">#&gt; Datsun 710      22.8   4  108  93</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 3: A custom projection</span></span>
<span><span class="nv">rel_project.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">exprs</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="c"># A real implementation would evaluate the expressions defined</span></span>
<span>  <span class="c"># by the exprs argument</span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">df</span><span class="o">[</span><span class="nf"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="o">(</span><span class="m">3</span>, <span class="nf"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="o">(</span><span class="nv">df</span><span class="o">)</span><span class="o">)</span><span class="o">)</span><span class="o">]</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_project</a></span><span class="o">(</span></span>
<span>  <span class="nv">mtcars_rel</span>,</span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_reference</a></span><span class="o">(</span><span class="s">"cyl"</span><span class="o">)</span>, <span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_reference</a></span><span class="o">(</span><span class="s">"disp"</span><span class="o">)</span><span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;                    mpg cyl disp</span></span>
<span><span class="c">#&gt; Mazda RX4         21.0   6  160</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag     21.0   6  160</span></span>
<span><span class="c">#&gt; Datsun 710        22.8   4  108</span></span>
<span><span class="c">#&gt; Hornet 4 Drive    21.4   6  258</span></span>
<span><span class="c">#&gt; Hornet Sportabout 18.7   8  360</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 4: A custom ordering (eg, ascending by mpg)</span></span>
<span><span class="nv">rel_order.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">exprs</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="c"># A real implementation would evaluate the expressions defined</span></span>
<span>  <span class="c"># by the exprs argument</span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">df</span><span class="o">[</span><span class="nf"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="o">(</span><span class="nv">df</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span><span class="o">)</span>, <span class="o">]</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_order</a></span><span class="o">(</span></span>
<span>  <span class="nv">mtcars_rel</span>,</span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relexpr.html">relexpr_reference</a></span><span class="o">(</span><span class="s">"mpg"</span><span class="o">)</span><span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;                    mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; Hornet Sportabout 18.7   8  360 175</span></span>
<span><span class="c">#&gt; Mazda RX4         21.0   6  160 110</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag     21.0   6  160 110</span></span>
<span><span class="c">#&gt; Hornet 4 Drive    21.4   6  258 110</span></span>
<span><span class="c">#&gt; Datsun 710        22.8   4  108  93</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 5: A custom join</span></span>
<span><span class="nv">rel_join.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">left</span>, <span class="nv">right</span>, <span class="nv">conds</span>, <span class="nv">join</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">left_df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">left</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span>  <span class="nv">right_df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">right</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="c"># A real implementation would evaluate the expressions</span></span>
<span>  <span class="c"># defined by the conds argument,</span></span>
<span>  <span class="c"># use different join types based on the join argument,</span></span>
<span>  <span class="c"># and implement the join itself instead of relaying to left_join().</span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nf">dplyr</span><span class="nf">::</span><span class="nf"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="o">(</span><span class="nv">left_df</span>, <span class="nv">right_df</span><span class="o">)</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_join</a></span><span class="o">(</span><span class="nf">new_dfrel</span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="o">(</span>mpg <span class="o">=</span> <span class="m">21</span><span class="o">)</span><span class="o">)</span>, <span class="nv">mtcars_rel</span><span class="o">)</span></span>
<span><span class="c">#&gt; Joining with `by = join_by(mpg)`</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;   mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; 1  21   6  160 110</span></span>
<span><span class="c">#&gt; 2  21   6  160 110</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 6: Limit the maximum rows returned</span></span>
<span><span class="nv">rel_limit.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">n</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">df</span><span class="o">[</span><span class="nf"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="o">(</span><span class="nv">n</span><span class="o">)</span>, <span class="o">]</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_limit</a></span><span class="o">(</span><span class="nv">mtcars_rel</span>, <span class="m">3</span><span class="o">)</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;                mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; Mazda RX4     21.0   6  160 110</span></span>
<span><span class="c">#&gt; Mazda RX4 Wag 21.0   6  160 110</span></span>
<span><span class="c">#&gt; Datsun 710    22.8   4  108  93</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 7: Suppress duplicate rows</span></span>
<span><span class="c">#  (ignoring row names)</span></span>
<span><span class="nv">rel_distinct.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">df</span><span class="o">[</span><span class="o">!</span><span class="nf"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="o">(</span><span class="nv">df</span><span class="o">)</span>, <span class="o">]</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_distinct</a></span><span class="o">(</span><span class="nf">new_dfrel</span><span class="o">(</span><span class="nv">mtcars</span><span class="o">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span>, <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="o">]</span><span class="o">)</span><span class="o">)</span></span>
<span><span class="c">#&gt; [[1]]</span></span>
<span><span class="c">#&gt;             mpg cyl disp  hp</span></span>
<span><span class="c">#&gt; Mazda RX4  21.0   6  160 110</span></span>
<span><span class="c">#&gt; Datsun 710 22.8   4  108  93</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; attr(,"class")</span></span>
<span><span class="c">#&gt; [1] "dfrel"      "relational"</span></span>
<span></span>
<span><span class="c"># Example 8: Return column names</span></span>
<span><span class="nv">rel_names.dfrel</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">rel</span>, <span class="nv">...</span><span class="o">)</span> <span class="o">{</span></span>
<span>  <span class="nv">df</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="o">(</span><span class="nv">rel</span><span class="o">)</span><span class="o">[[</span><span class="m">1</span><span class="o">]</span><span class="o">]</span></span>
<span></span>
<span>  <span class="nf"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="o">(</span><span class="nv">df</span><span class="o">)</span></span>
<span><span class="o">}</span></span>
<span></span>
<span><span class="nf"><a href="https://duckdblabs.github.io/duckplyr/reference/new_relational.html">rel_names</a></span><span class="o">(</span><span class="nv">mtcars_rel</span><span class="o">)</span></span>
<span><span class="c">#&gt; [1] "mpg"  "cyl"  "disp" "hp"</span></span></pre>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=duckplyr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/duckdblabs/duckplyr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/duckdblabs/duckplyr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing duckplyr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Hannes Mühleisen <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-8552-0029" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://krlmlr.info" class="external-link">Kirill Müller</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1416-3412" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Posit Software, PBC <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/duckdblabs/duckplyr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/duckdblabs/duckplyr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hannes Mühleisen, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
