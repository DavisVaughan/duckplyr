# Generated by 02-duckplyr_df-methods.R
#' @export
dplyr_col_modify.duckplyr_df <- function(data, cols) {
  # Our implementation
  rel_try(
    # Always fall back to dplyr
    "-" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  dplyr_col_modify <- dplyr$dplyr_col_modify.data.frame
  out <- dplyr_col_modify(data, cols)
  return(out)

  # dplyr implementation
  # Must be implemented from first principles to avoiding edge cases in
  # [.data.frame and [.tibble (2.1.3 and earlier).

  # Apply tidyverse recycling rules
  cols <- vec_recycle_common(!!!cols, .size = nrow(data))

  # Transform to list to avoid stripping inner names with `[[<-`
  out <- as.list(vec_data(data))

  nms <- as_utf8_character(names2(cols))
  names(out) <- as_utf8_character(names2(out))

  for (i in seq_along(cols)) {
    nm <- nms[[i]]
    out[[nm]] <- cols[[i]]
  }

  # Transform back to data frame before reconstruction
  row_names <- .row_names_info(data, type = 0L)
  out <- new_data_frame(out, n = nrow(data), row.names = row_names)

  dplyr_reconstruct(out, data)
}

duckplyr_dplyr_col_modify <- function(data, ...) {
  try_fetch(
    data <- as_duckplyr_df(data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- dplyr_col_modify(data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}
