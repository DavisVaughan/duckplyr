# Generated by 03-tests.R

test_that("as_duckplyr_df() commutes for add_count()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% add_count()
  post <- test_df %>% add_count() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for anti_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% anti_join(test_df_y)
  post <- test_df_x %>% anti_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for arrange()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% arrange()
  post <- test_df %>% arrange() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for auto_copy()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% auto_copy(test_df_y)
  post <- test_df_x %>% auto_copy(test_df_y)

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for collapse()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% collapse()
  post <- test_df %>% collapse() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for collect()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% collect()
  post <- test_df %>% collect() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for compute()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% compute()
  post <- test_df %>% compute() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for count()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% count()
  post <- test_df %>% count() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for cross_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% cross_join(test_df_y)
  post <- test_df_x %>% cross_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for distinct()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% distinct()
  post <- test_df %>% distinct() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for do()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% do(data.frame(c = 1))
  post <- test_df %>% do(data.frame(c = 1)) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for dplyr_reconstruct()", {
  skip("Hack")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% dplyr_reconstruct(test_df)
  post <- test_df %>% dplyr_reconstruct(test_df)

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for filter()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% filter()
  post <- test_df %>% filter() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for full_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% full_join(test_df_y)
  post <- test_df_x %>% full_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_by()", {
  skip("Grouped")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_by()
  post <- test_df %>% group_by() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_data()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_data()
  post <- test_df %>% group_data() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_indices()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_indices()
  post <- test_df %>% group_indices()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_keys()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_keys()
  post <- test_df %>% group_keys() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_map()", {
  skip("WAT")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_map(~ .x)
  post <- test_df %>% group_map(~ .x) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_modify()", {
  skip("Grouped")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_modify(~ .x)
  post <- test_df %>% group_modify(~ .x) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_nest()", {
  skip("Always returns tibble")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_nest()
  post <- test_df %>% group_nest() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_size()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_size()
  post <- test_df %>% group_size()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_split()", {
  skip("WAT")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_split()
  post <- test_df %>% group_split() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_trim()", {
  skip("Grouped")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_trim()
  post <- test_df %>% group_trim() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for group_vars()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% group_vars()
  post <- test_df %>% group_vars()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for groups()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% groups()
  post <- test_df %>% groups()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for inner_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% inner_join(test_df_y)
  post <- test_df_x %>% inner_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for intersect()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% intersect(test_df_y)
  post <- test_df_x %>% intersect(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for left_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% left_join(test_df_y)
  post <- test_df_x %>% left_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for mutate()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% mutate()
  post <- test_df %>% mutate() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for n_groups()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% n_groups()
  post <- test_df %>% n_groups()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for nest_by()", {
  skip("WAT")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% nest_by()
  post <- test_df %>% nest_by() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for nest_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% nest_join(test_df_y)
  post <- test_df_x %>% nest_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for pull()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% pull()
  post <- test_df %>% pull()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for reframe()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% reframe()
  post <- test_df %>% reframe() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for relocate()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% relocate()
  post <- test_df %>% relocate() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rename()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% rename()
  post <- test_df %>% rename() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rename_with()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% rename_with(identity)
  post <- test_df %>% rename_with(identity) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for right_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% right_join(test_df_y)
  post <- test_df_x %>% right_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_append()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_append(test_df_y)
  post <- test_df_x %>% rows_append(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_delete()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_delete(test_df_y)
  post <- test_df_x %>% rows_delete(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_insert()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_insert(test_df_y, conflict = "ignore")
  post <- test_df_x %>% rows_insert(test_df_y, conflict = "ignore") %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_patch()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_patch(test_df_y)
  post <- test_df_x %>% rows_patch(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_update()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_update(test_df_y)
  post <- test_df_x %>% rows_update(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rows_upsert()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% rows_upsert(test_df_y)
  post <- test_df_x %>% rows_upsert(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for rowwise()", {
  skip("Stack overflow")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% rowwise()
  post <- test_df %>% rowwise() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for sample_frac()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% sample_frac()
  post <- test_df %>% sample_frac() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for sample_n()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% sample_n(size = 1)
  post <- test_df %>% sample_n(size = 1) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for select()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% select()
  post <- test_df %>% select() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for semi_join()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% semi_join(test_df_y)
  post <- test_df_x %>% semi_join(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for setdiff()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% setdiff(test_df_y)
  post <- test_df_x %>% setdiff(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for setequal()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% setequal(test_df_y)
  post <- test_df_x %>% setequal(test_df_y)

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice()
  post <- test_df %>% slice() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice_head()", {
  skip("External vector?")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice_head()
  post <- test_df %>% slice_head() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice_max()", {
  skip("External vector?")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice_max("a")
  post <- test_df %>% slice_max("a") %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice_min()", {
  skip("External vector?")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice_min("a")
  post <- test_df %>% slice_min("a") %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice_sample()", {
  skip("External vector?")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice_sample()
  post <- test_df %>% slice_sample() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for slice_tail()", {
  skip("External vector?")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% slice_tail()
  post <- test_df %>% slice_tail() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for summarise()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% summarise()
  post <- test_df %>% summarise() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for symdiff()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% symdiff(test_df_y)
  post <- test_df_x %>% symdiff(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for tally()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% tally()
  post <- test_df %>% tally() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for tbl_vars()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% tbl_vars()
  post <- test_df %>% tbl_vars()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for transmute()", {
  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% transmute()
  post <- test_df %>% transmute() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for ungroup()", {
  skip("Grouped")

  # Data
  test_df <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df %>% as_duckplyr_df() %>% ungroup()
  post <- test_df %>% ungroup() %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for union()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% union(test_df_y)
  post <- test_df_x %>% union(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})

test_that("as_duckplyr_df() commutes for union_all()", {
  # Data
  test_df_x <- data.frame(a = 1, b = 2)
  test_df_y <- data.frame(a = 1, b = 2)

  # Run
  pre <- test_df_x %>% as_duckplyr_df() %>% union_all(test_df_y)
  post <- test_df_x %>% union_all(test_df_y) %>% as_duckplyr_df()

  # Compare
  expect_equal(pre, post)
})
